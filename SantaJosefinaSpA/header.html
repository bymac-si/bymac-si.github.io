<style>
  /* =========================================
     HEADER - ESTILO UNIFICADO
     ========================================= */
  
  .main-header {
    background-color: #ffffff;
    border-bottom: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    padding: 0 25px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 1000;
    width: 100%;
    box-sizing: border-box; /* Asegura que el padding no rompa el ancho */
  }

  .logo-img { 
    height: 70px; /* Ajustado para que no rompa el header de 70px */
    width: auto; 
    transition: transform 0.2s; 
    display: block; 
  }
  .logo-img:hover { transform: scale(1.05); }

  /* --- MENU DESKTOP --- */
  .nav-container {
    display: flex; 
    gap: 5px; 
    height: 100%; 
    align-items: center; 
    margin-left: auto;
  }

  .nav-link {
    text-decoration: none; 
    color: #64748b; 
    font-weight: 600; 
    font-size: 13px;
    padding: 8px 12px; 
    border-radius: 6px; 
    transition: all 0.2s;
    display: flex; 
    align-items: center; 
    gap: 6px; 
    white-space: nowrap;
    cursor: pointer;
  }
  .nav-link:hover { color: #0f172a; background-color: #f1f5f9; }
  .nav-link i { font-size: 14px; }

  /* Dropdowns */
  .nav-dropdown { 
    position: relative; 
    height: 100%; 
    display: flex; 
    align-items: center; 
  }
  
  .dropdown-menu {
    display: none; 
    position: absolute; 
    top: 60px; 
    left: 0;
    background: white; 
    min-width: 220px;
    border: 1px solid #e2e8f0; 
    border-radius: 8px;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    padding: 5px 0; 
    margin: 0;
    list-style: none; 
    z-index: 1001;
    animation: fadeIn 0.15s ease;
  }
  
  /* DESKTOP: hover funciona */
  @media (min-width: 1101px) {
    .nav-dropdown:hover .dropdown-menu { display: block; }
  }
  
  /* MOBILE/TABLET: usar clase .active */
  .dropdown-menu.active { display: block; }
  
  .dropdown-menu li a {
    display: flex; 
    align-items: center; 
    gap: 10px;
    padding: 10px 15px; 
    color: #475569; 
    text-decoration: none;
    font-size: 13px; 
    transition: background 0.2s;
  }
  .dropdown-menu li a:hover { 
    background-color: #f8fafc; 
    color: #0f172a; 
    padding-left: 20px; 
  }
  .dropdown-menu li a i { 
    width: 18px; 
    text-align: center; 
    color: #94a3b8; 
  }
  
  /* Submenús */
  .dropdown-submenu { position: relative; }
  .dropdown-submenu .submenu {
    display: none; 
    position: absolute; 
    top: -5px; 
    left: 100%; 
    margin-left: 5px;
    background: white; 
    border-radius: 8px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border: 1px solid #e2e8f0; 
    min-width: 180px; 
    padding: 5px 0; 
    list-style: none;
  }
  
  @media (min-width: 1101px) {
    .dropdown-submenu:hover > .submenu { display: block; }
  }
  .dropdown-submenu .submenu.active { display: block; }

  /* User Area */
  .user-actions {
    display: flex; 
    align-items: center; 
    gap: 15px; 
    margin-left: 20px;
    padding-left: 20px; 
    border-left: 1px solid #e2e8f0; 
    height: 40px;
  }
  .user-info { text-align: right; line-height: 1.2; }
  .user-name { 
    font-weight: 700; 
    font-size: 13px; 
    color: #1e293b; 
    display: block; 
  }
  .user-role { 
    font-size: 11px; 
    color: #94a3b8; 
    text-transform: uppercase; 
  }
  .btn-logout {
    color: #ef4444; 
    border: 1px solid #fee2e2; 
    background: #fef2f2;
    width: 32px; 
    height: 32px; 
    border-radius: 6px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    transition: 0.2s;
    cursor: pointer;
    text-decoration: none;
  }
  .btn-logout:hover { 
    background: #fee2e2; 
    transform: scale(1.05); 
  }

  /* Mobile Toggle */
  .mobile-toggle { 
    display: none; 
    background: none; 
    border: none; 
    font-size: 24px; 
    color: #1e293b; 
    cursor: pointer;
    padding: 5px;
  }

  @keyframes fadeIn { 
    from { opacity: 0; transform: translateY(-5px); } 
    to { opacity: 1; transform: translateY(0); } 
  }

  /* =========================================
     RESPONSIVE (TABLET / MOBILE)
     ========================================= */
  @media (max-width: 1100px) {
    .mobile-toggle { display: block; }
    
    .nav-container {
      display: none; 
      position: fixed; 
      top: 70px; 
      left: 0; 
      width: 100%; 
      height: calc(100vh - 70px);
      background: white; 
      flex-direction: column; 
      align-items: flex-start;
      padding: 0; 
      overflow-y: auto; 
      border-top: 1px solid #e2e8f0;
      z-index: 999; /* Z-INDEX IMPORTANTE PARA QUE SE VEA */
    }
    .nav-container.active { display: flex; }

    .nav-link, .nav-dropdown { width: 100%; }
    .nav-link { 
      padding: 15px 20px; 
      border-bottom: 1px solid #f1f5f9; 
      font-size: 15px; 
      justify-content: space-between;
      border-radius: 0;
    }
    
    .dropdown-menu {
      position: static; 
      box-shadow: none; 
      border: none; 
      border-radius: 0;
      width: 100%; 
      padding: 0; 
      background: #f8fafc;
      animation: none;
    }

    .dropdown-menu li a { 
      padding-left: 40px; 
      border-bottom: 1px solid #eee; 
    }

    .dropdown-submenu .submenu {
      position: static;
      margin-left: 0;
      box-shadow: none;
      border-radius: 0;
      background: #f1f5f9;
    }

    .dropdown-submenu .submenu li a {
      padding-left: 60px;
    }
    
    .user-actions {
      width: 100%; 
      margin: 0; 
      padding: 20px; 
      border-top: 1px solid #e2e8f0; 
      border-left: none;
      justify-content: space-between; 
      flex-direction: row-reverse; 
      background: #fff; 
      margin-top: auto;
      box-sizing: border-box;
    }
    .user-info { text-align: left; }
  }
</style>

<header class="main-header">
  <a href="index.html" style="text-decoration: none">
    <img src="assets/img/logo_santajosefina.png" alt="Santa Josefina" class="logo-img" />
  </a>

  <button class="mobile-toggle" onclick="toggleMenu()">
    <i class="fa-solid fa-bars"></i>
  </button>

  <nav class="nav-container" id="navMenu">
    
    <div class="nav-dropdown">
      <a href="#" class="nav-link" onclick="toggleDropdown(event, this)">
        <div style="display:flex; align-items:center; gap:6px;">
          <i class="fa-solid fa-handshake"></i> Corretaje
        </div>
        <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a href="dashboard.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="contactos.html"><i class="fa-solid fa-inbox"></i> Buzón Web</a></li>
        <li><a href="clientes.html"><i class="fa-solid fa-users"></i> Clientes</a></li>
        <li><a href="arrendatarios.html"><i class="fa-solid fa-key"></i> Arrendatarios</a></li>
        <li><a href="propiedades.html"><i class="fa-solid fa-house"></i> Propiedades</a></li>
      </ul>
    </div>

    <div class="nav-dropdown">
      <a href="#" class="nav-link" onclick="toggleDropdown(event, this)">
        <div style="display:flex; align-items:center; gap:6px;">
          <i class="fa-solid fa-building"></i> Condominios
        </div>
        <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a href="dashboardcopropiedades.html"><i class="fa-solid fa-chart-pie"></i> Dashboard</a></li>
        <li><a href="copropiedades.html"><i class="fa-solid fa-city"></i> Comunidades</a></li>
        <li><a href="unidades.html"><i class="fa-solid fa-door-closed"></i> Unidades</a></li>
        <li><a href="copropietarios.html"><i class="fa-solid fa-user-group"></i> Residentes</a></li>
        <li class="dropdown-submenu">
          <a href="#" onclick="toggleSubmenu(event, this)" style="justify-content:space-between;">
            <span><i class="fa-solid fa-user-plus"></i> Prospectos</span>
            <i class="fa-solid fa-chevron-right" style="font-size: 10px"></i>
          </a>
          <ul class="dropdown-menu submenu">
            <li><a href="prospectos.html">Listado</a></li>
            <li><a href="mapa.html">Mapa</a></li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="nav-dropdown">
      <a href="#" class="nav-link" onclick="toggleDropdown(event, this)">
        <div style="display:flex; align-items:center; gap:6px;">
          <i class="fa-solid fa-coins"></i> Finanzas
        </div>
        <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a href="conciliacion.html"><i class="fa-solid fa-check-double"></i> Conciliación</a></li>
        <li><a href="gastos.html"><i class="fa-solid fa-file-invoice-dollar"></i> Gastos Comunes</a></li>
        <li><a href="proveedores.html"><i class="fa-solid fa-truck-field"></i> Proveedores</a></li>
        <li><a href="reportes.html"><i class="fa-solid fa-file-pdf"></i> Reportes</a></li>
      </ul>
    </div>

    <div class="nav-dropdown">
      <a href="#" class="nav-link" onclick="toggleDropdown(event, this)">
        <div style="display:flex; align-items:center; gap:6px;">
          <i class="fa-solid fa-tree"></i> Espacios
        </div>
        <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a href="gestion_reservas.html"><i class="fa-regular fa-calendar-check"></i> Reservas</a></li>
        <li><a href="admin-espacios.html"><i class="fa-solid fa-pen-ruler"></i> Configurar</a></li>
        <li><a href="gestion_reclamos.html"><i class="fa-solid fa-triangle-exclamation"></i> Reclamos</a></li>
      </ul>
    </div>
<div class="nav-dropdown">
      <a href="#" class="nav-link" onclick="toggleDropdown(event, this)">
        <div style="display:flex; align-items:center; gap:6px;">
          <i class="fa-solid fa-bullhorn"></i> MKT
    </div>
        <i class="fa-solid fa-chevron-down" style="font-size: 10px;"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a href="dashboard_conversiones.html"><i class="fa-regular fa-chart-bar"></i> Dashboard Conversiones</a></li>
        <li><a href="marketing.html"><i class="fa-solid fa-bullhorn"></i> Campañas</a></li>
        <li><a href="envia_campaigns.html"><i class="fa-solid fa-paper-plane"></i> Envíos de Campañas</a></li>
        <li><a href="analitica.html"><i class="fa-solid fa-magnifying-glass-dollar"></i> Análisis de Campañas</a></li>
        <li><a href="gestion_leads.html"><i class="fa-solid fa-person-walking-arrow-right"></i> Gestión de Leads</a></li>
      </ul>
    </div>
    <a href="agentes.html" class="nav-link"><i class="fa-solid fa-user-tie"></i> Agentes</a>

    <div class="user-actions">
      <div class="user-info">
        <span class="user-name" id="headerUserName">Usuario</span>
        <span class="user-role" id="headerUserRole">Agente</span>
      </div>
      <a href="#" class="btn-logout" onclick="logout(event)" title="Salir">
        <i class="fa-solid fa-power-off"></i>
      </a>
    </div>
    
  </nav>
</header>

<script>
  // Usamos una función de inicialización que se asegure de que el DOM esté listo
  (function() {
    
    // 1. Toggle menú principal (Hamburger)
    window.toggleMenu = function() {
      const nav = document.getElementById('navMenu');
      if (nav) {
          nav.classList.toggle('active');
          console.log("Menú toggleado"); // Para debug
      } else {
          console.error("No se encontró el elemento #navMenu");
      }
    };
    
    // 2. Toggle dropdowns (Móvil)
    window.toggleDropdown = function(event, element) {
      if (window.innerWidth <= 1100) {
        event.preventDefault();
        const dropdown = element.nextElementSibling;
        
        // Cerrar otros abiertos para que no se amontonen
        document.querySelectorAll('.nav-dropdown > .dropdown-menu').forEach(menu => {
          if (menu !== dropdown) menu.classList.remove('active');
        });
        
        dropdown.classList.toggle('active');
      }
    };

    // 3. Toggle submenús (Móvil)
    window.toggleSubmenu = function(event, element) {
      if (window.innerWidth <= 1100) {
        event.preventDefault();
        event.stopPropagation();
        const submenu = element.nextElementSibling;
        submenu.classList.toggle('active');
      }
    };
    
    // 4. Limpieza al redimensionar
    window.addEventListener('resize', function() {
      if (window.innerWidth > 1100) {
        document.querySelectorAll('.dropdown-menu.active, .submenu.active, .nav-container.active')
                .forEach(el => el.classList.remove('active'));
      }
    });

    // 5. Cargar datos del usuario al cargar el componente
    // Usamos un pequeño timeout para asegurar que el DOM se renderizó
    setTimeout(() => {
      try {
        const s = localStorage.getItem('sesion_activa');
        if(s) {
          const u = JSON.parse(s);
          const elName = document.getElementById('headerUserName');
          const elRole = document.getElementById('headerUserRole');
          if(elName && u.Nombre) elName.innerText = u.Nombre.split(' ')[0];
          if(elRole && u.Rol) elRole.innerText = u.Rol;
        }
      } catch(e) { console.warn('Error cargando user info', e); }
    }, 100);

    window.logout = function(event) {
      event.preventDefault();
      if (confirm('¿Deseas cerrar sesión?')) {
        localStorage.removeItem('sesion_activa');
        window.location.href = 'login.html';
      }
    };
  })();
</script>