<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Gestión Prospectos Móvil</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/mobile.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a2b48" />
    <link rel="apple-touch-icon" href="assets/img/icon-192.png" />

    <script src="assets/js/app.js"></script>
    <script>
      requireAuth();
    </script>

    
      <link rel="stylesheet" href="assets/css/pages/mobile_prospecto.inline.css">
</head>
  <body>
    <div class="mobile-header"><img
        src="assets/img/logo_santajosefina.png"
        class="m-logo"
        alt="Santa Josefina"
      />
      <div class="header-title" id="pageTitle">Gestión Prospectos</div>
      <div onclick="goBack()" style="cursor: pointer; opacity: 0.8" id="btnBack">
        <i class="fa-solid fa-home"></i>
      </div>
    </div>

    <div id="viewMenu" class="menu-container">
      <div class="menu-card" onclick="switchView('form')">
        <div class="menu-icon"><i class="fa-solid fa-user-plus"></i></div>
        <div class="menu-title">Nuevo Prospecto</div>
        <div class="menu-desc">Registrar visita en terreno o cliente.</div>
      </div>

      <div class="menu-card" onclick="switchView('list')">
        <div class="menu-icon"><i class="fa-solid fa-list-ul"></i></div>
        <div class="menu-title">Ver Listado</div>
        <div class="menu-desc">Revisar mis prospectos recientes.</div>
      </div>
    </div>

    <div id="viewList" class="list-container hidden">
      <div style="margin-bottom: 10px">
        <input
          type="text"
          id="searchList"
          placeholder="Buscar..."
          oninput="filtrarLista()"
          style="background: white; border: 1px solid #e2e8f0"
        />
      </div>
      <div id="listaContenido">
        <div style="text-align: center; padding: 40px; color: #94a3b8">
          Cargando...
        </div>
      </div>
    </div>

    <div id="viewForm" class="hidden">
      <form id="formProspecto" class="form-container" autocomplete="off">
        <input type="hidden" id="editId"> <div class="input-group">
          <label class="input-label">Tipo de Negocio</label>
          <div class="radio-group">
            <div class="radio-option">
              <input
                type="radio"
                name="operacion"
                id="opVenta"
                value="Venta"
                onchange="toggleForm('corretaje')"
              />
              <label for="opVenta"
                ><i class="fa-solid fa-sack-dollar"></i> Venta</label
              >
            </div>
            <div class="radio-option">
              <input
                type="radio"
                name="operacion"
                id="opArriendo"
                value="Arriendo"
                onchange="toggleForm('corretaje')"
              />
              <label for="opArriendo"
                ><i class="fa-solid fa-key"></i> Arriendo</label
              >
            </div>
            <div class="radio-option">
              <input
                type="radio"
                name="operacion"
                id="opAdmin"
                value="Administracion"
                checked
                onchange="toggleForm('admin')"
              />
              <label for="opAdmin"
                ><i class="fa-solid fa-building-user"></i> Admin</label
              >
            </div>
          </div>
        </div>

        <div class="input-group">
          <label class="input-label" id="lblNombre"
            >Nombre Condominio / Cliente</label
          >
          <input
            type="text"
            id="nombre"
            placeholder="Ej: Edificio Los Andes"
            required
          />
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1.3fr;
              gap: 10px;
              margin-top: 10px;
            "
          >
            <div>
              <label class="input-label">Teléfono</label
              ><input type="tel" id="telefono" placeholder="+569..." required />
            </div>
            <div>
              <label class="input-label">Email</label
              ><input type="email" id="email" placeholder="@mail.com" />
            </div>
          </div>
        </div>

        <div id="fieldsAdmin">
          <div class="input-group">
            <label class="input-label">Ubicación</label>
            <div
              style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 10px"
            >
              <input
                type="text"
                id="direccion"
                placeholder="Calle y Número"
                onchange="intentarGeocodificar()"
              />
              <input
                type="text"
                id="comuna"
                placeholder="Comuna..."
                onchange="intentarGeocodificar()"
              />
            </div>
            <button
              type="button"
              class="btn-gps"
              onclick="obtenerGPS()"
              id="btnGps"
            >
              <i class="fa-solid fa-location-crosshairs"></i> Guardar mi
              ubicación
            </button>
            <input type="hidden" id="latlong" name="latlong" />
            <div
              id="msgGeo"
              style="
                font-size: 11px;
                color: #10b981;
                margin-top: 5px;
                display: none;
                text-align: center;
              "
            >
              <i class="fa-solid fa-check"></i> Coordenadas detectadas
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">RUT Comunidad (Opcional)</label>
            <input type="text" id="rut" placeholder="12.345.678-9" />
          </div>
          <div class="input-group">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <label class="input-label" style="margin: 0"
                >Cantidad Unidades</label
              >
              <span
                id="badgeEstimacion"
                style="
                  font-size: 11px;
                  background: #e0f2fe;
                  padding: 2px 6px;
                  border-radius: 4px;
                  color: #0369a1;
                "
                >Est. Honorarios: $0</span
              >
            </div>
            <input
              type="number"
              id="unidades"
              placeholder="Ej: 80"
              oninput="calcularEstimacion()"
            />
          </div>
        </div>

        <div id="fieldsCorretaje" class="hidden">
          <div class="input-group">
            <label class="input-label">Tipo Propiedad</label>
            <select id="tipoPropiedad">
              <option value="Casa">Casa</option>
              <option value="Departamento">Departamento</option>
              <option value="Terreno">Terreno</option>
              <option value="Parcela">Parcela</option>
              <option value="Oficina">Oficina</option>
            </select>
          </div>
          <div class="input-group">
            <label class="input-label">Presupuesto</label>
            <input type="number" id="presupuesto" placeholder="$" />
          </div>
        </div>

        <div class="input-group">
          <label class="input-label">Notas / Observaciones</label>
          <textarea id="obs" rows="3" placeholder="Comentarios..."></textarea>
        </div>

        <button type="submit" class="fab-save">
          <i class="fa-solid fa-paper-plane"></i> Enviar Prospecto
        </button>
      </form>
    </div>

    <div id="loader" class="spinner-overlay">
      <div class="spinner"></div>
      <div style="margin-top: 15px; font-weight: 600; color: #1a2b48">
        Cargando...
      </div>
    </div>

    <div id="toastSuccess" class="success-toast">
      <i class="fa-solid fa-check-circle"></i> Guardado con éxito
    </div>

    <script src="assets/js/pages/mobile_prospecto.inline.js"></script>
    <div id="actionSheetOverlay" class="sheet-overlay" onclick="cerrarActionSheet()">
  <div class="action-sheet" onclick="event.stopPropagation()"> <div class="sheet-header">
      <h3 class="sheet-title" id="sheetName">Nombre Prospecto</h3>
      <div class="sheet-subtitle" id="sheetInfo">Detalles...</div>
    </div>

    <div class="sheet-grid">
      <div class="sheet-btn" onclick="irABitacora()">
        <i class="fa-solid fa-clock-rotate-left sheet-icon icon-bitacora"></i>
        <span class="sheet-label">Bitácora</span>
      </div>

      <div class="sheet-btn" onclick="prepararEdicion()">
        <i class="fa-solid fa-pen-to-square sheet-icon icon-edit"></i>
        <span class="sheet-label">Editar</span>
      </div>

      <a href="#" id="btnSheetWhatsapp" class="sheet-btn" target="_blank">
        <i class="fa-brands fa-whatsapp sheet-icon icon-whatsapp"></i>
        <span class="sheet-label">WhatsApp</span>
      </a>

      <div class="sheet-btn" onclick="irACotizar()">
        <i class="fa-solid fa-file-invoice-dollar sheet-icon icon-quote"></i>
        <span class="sheet-label">Cotizar</span>
      </div>

      <div class="sheet-btn" onclick="verEnMapa()">
        <i class="fa-solid fa-map-location-dot sheet-icon"></i>
        <span class="sheet-label">Mapa</span>
      </div>

      <a href="#" id="btnSheetTel" class="sheet-btn">
        <i class="fa-solid fa-phone sheet-icon"></i>
        <span class="sheet-label">Llamar</span>
      </a>
    </div>

    <button onclick="cerrarActionSheet()" style="width:100%; margin-top:20px; padding:12px; background:white; border:1px solid #cbd5e1; border-radius:10px; color:#64748b; font-weight:bold;">Cancelar</button>
  </div>
</div>
  </body>
</html>