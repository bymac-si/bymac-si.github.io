<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRM - Gesti√≥n de Clientes</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a2b48" />
    <link rel="apple-touch-icon" href="assets/img/icon-192.png" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script src="assets/js/app.js"></script>
    <script>
      requireAuth();
    </script>

    
      <link rel="stylesheet" href="assets/css/pages/clientes.inline.css">
</head>
  <body>
    <div id="header"></div>

    <main>
      <div class="dashboard-header no-print">
        <div class="header-top">
          <h1 class="page-title">Gesti√≥n de Clientes</h1>
          <div class="header-actions">
            <button
              class="btn-head btn-secundario"
              id="btnReload"
              title="Recargar"
            >
              <i class="fa-solid fa-rotate-right"></i>
            </button>
            <button
              class="btn-head btn-secundario"
              id="btnExport"
              title="Exportar CSV"
            >
              <i class="fa-solid fa-file-csv"></i>
            </button>
            <button class="btn-head btn-nuevo" id="btnNew">
              <i class="fa-solid fa-plus"></i> <span>Nuevo Cliente</span>
            </button>
          </div>
        </div>

        <div class="header-filters">
          <div class="filter-item" style="flex-grow: 2">
            <label class="label">Buscar</label>
            <input
              id="inpBuscar"
              class="input-modern"
              placeholder="Nombre, RUT, email..."
              type="text"
            />
          </div>
          <div class="filter-item">
            <label class="label">Segmento</label>
            <select
              id="filSegmento"
              class="input-modern"
              onchange="aplicarFiltros()"
            >
              <option value="">(Todos)</option>
              <option value="VIP">VIP</option>
              <option value="Inversionista">Inversionista</option>
              <option value="Habitacional">Habitacional</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="label">Estado</label>
            <select
              id="filEstado"
              class="input-modern"
              onchange="aplicarFiltros()"
            >
              <option value="">(Todos)</option>
              <option value="Activo">Activo</option>
              <option value="Inactivo">Inactivo</option>
            </select>
          </div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Cliente / RUT</th>
            <th>Contacto</th>
            <th>Inter√©s Principal</th>
            <th>Segmento</th>
            <th>Estado</th>
            <th>Agente</th>
            <th class="no-print" style="width: 140px">Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaClientes">
          <tr>
            <td colspan="7" class="muted">Cargando datos...</td>
          </tr>
        </tbody>
      </table>
    </main>

    <div id="modalCliente" class="modal" aria-hidden="true">
      <div class="modal-content">
        <h2 id="modalTitleCliente" style="margin-top: 0">Ficha Cliente</h2>
        <form id="formCliente" style="margin-top: 20px">
          <input type="hidden" id="clienteID" />

          <div style="display: flex; gap: 15px; margin-bottom: 15px">
            <div style="flex: 2">
              <label class="label">Nombre Completo</label>
              <input id="clienteNombre" required placeholder="Ej: Juan P√©rez" />
            </div>
            <div style="flex: 1">
              <label class="label">RUT</label>
              <input id="clienteRUT" placeholder="11.111.111-1" />
            </div>
          </div>

          <div style="display: flex; gap: 15px; margin-bottom: 15px">
            <div style="flex: 1">
              <label class="label">Email</label>
              <input id="clienteEmail" type="email" />
            </div>
            <div style="flex: 1">
              <label class="label">Tel√©fono</label>
              <input id="clienteTelefono" />
            </div>
          </div>

          <div style="display: flex; gap: 15px; margin-bottom: 15px">
            <div style="flex: 1">
              <label class="label">Segmento</label>
              <select id="clienteSegmento">
                <option value="Habitacional">Habitacional</option>
                <option value="Inversionista">Inversionista</option>
                <option value="VIP">VIP</option>
              </select>
            </div>
            <div style="flex: 1">
              <label class="label">Estado</label>
              <select id="clienteEstado">
                <option value="Activo">Activo</option>
                <option value="Inactivo">Inactivo</option>
              </select>
            </div>
          </div>

          <div style="display: flex; gap: 15px; margin-bottom: 15px">
            <div style="flex: 2">
              <label class="label">Inter√©s (Propiedad Buscada)</label>
              <input id="clienteInteres" placeholder="Ej: Depto 2D2B Centro" />
            </div>
            <div style="flex: 1">
              <label class="label">Canal</label>
              <select id="clienteCanal">
                <option value="Web Landing">Web</option>
                <option value="Referido">Referido</option>
                <option value="Portal Inmobiliario">Portal</option>
                <option value="Presencial">Presencial</option>
              </select>
            </div>
          </div>

          <div
            style="
              text-align: right;
              margin-top: 20px;
              display: flex;
              justify-content: flex-end;
              gap: 10px;
            "
          >
            <button
              type="button"
              class="btn-head btn-secundario"
              onclick="cerrarModalCliente()"
            >
              Cancelar
            </button>
            <button type="submit" class="btn-head btn-nuevo">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="modalSeguimiento" class="modal" aria-hidden="true">
      <div class="modal-content" style="max-width: 600px">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <h2 style="margin: 0">
            <i class="fa-solid fa-clock-rotate-left"></i> Historial
          </h2>
          <button
            onclick="document.getElementById('modalSeguimiento').classList.remove('active')"
            class="btn-icon"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <p
          id="segSubtitulo"
          class="muted"
          style="margin-top: -5px; font-size: 13px"
        >
          Cliente: ...
        </p>

        <div id="timelineContainer" class="chat-container"></div>

        <div
          style="
            margin-top: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
          "
        >
          <div style="display: flex; gap: 10px; margin-bottom: 10px">
            <select id="segTipo" class="input-modern" style="width: 140px">
              <option value="Nota">üìù Nota</option>
              <option value="Llamada">üìû Llamada</option>
              <option value="Whatsapp">üí¨ WhatsApp</option>
              <option value="Correo">üìß Correo</option>
              <option value="Reunion">ü§ù Reuni√≥n</option>
              <option value="Compromiso">üìå Compromiso</option>
            </select>
            <input type="date" id="segFecha" class="input-modern" />
          </div>
          <textarea
            id="segNota"
            rows="2"
            style="
              width: 96%;
              padding: 10px;
              border-radius: 6px;
              border: 1px solid #cbd5e1;
            "
            placeholder="Detalle..."
          ></textarea>
          <div style="text-align: right; margin-top: 10px">
            <button
              class="btn-head btn-nuevo"
              onclick="guardarInteraccion()"
              style="height: 36px"
            >
              Registrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="pageSpinner" class="spinner-backdrop" aria-hidden="true">
      <div class="spinner-card">
        <div class="spinner"></div>
        <div id="spinnerText">Cargando...</div>
      </div>
    </div>

    <div id="footer"></div>

    <script src="assets/js/pages/clientes.inline.js"></script>
  </body>
</html>
