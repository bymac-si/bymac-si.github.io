<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CRM - Conciliación de Pagos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="assets/css/styles.css">
  <script src="assets/js/app.js"></script>
  <script>requireAuth();</script>

  
    <link rel="stylesheet" href="assets/css/pages/conciliacion.inline.css">
</head>
<body>
  <div id="header"></div>

  <main>
    <div class="dashboard-header no-print">
      <div class="header-top">
        <div>
          <h1 class="page-title" style="margin:0;">Conciliación Bancaria</h1>
          <p class="muted" style="margin:5px 0 0; font-size:13px;">Valida los pagos reportados por los residentes.</p>
        </div>
        <div>
          <button class="btn-primary" onclick="cargarDatos()" style="background: white; color: #475569; border: 1px solid #cbd5e1;">
            <i class="fa-solid fa-rotate-right"></i> Recargar
          </button>
        </div>
      </div>

      <div class="header-filters">
        <div style="flex: 1;">
          <label class="label">Buscar</label>
          <input id="inpBuscar" class="input-modern" style="width: 97%; height: 42px;" placeholder="Unidad, monto, ID..." oninput="aplicarFiltros()">
        </div>
        <div style="width: 200px;">
          <label class="label">Estado</label>
          <select id="selEstado" onchange="aplicarFiltros()">
            <option value="Pendiente">Pendientes</option> <option value="Aprobado">Aprobados</option>
            <option value="Rechazado">Rechazados</option>
            <option value="">(Todos)</option>
          </select>
        </div>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Unidad</th>
          <th>Monto</th>
          <th>Método</th>
          <th style="text-align:center;">Comprobante</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaPagos">
        <tr><td colspan="7" class="muted">Cargando pagos...</td></tr>
      </tbody>
    </table>
  </main>

  <div id="modalRevision" class="modal">
    <div class="modal-content">
      <h2 style="margin:0 0 5px;">Revisar Pago</h2>
      <p class="muted" id="modalSubtitulo">...</p>
      
      <div style="background:#f9fafb; min-height:150px; display:flex; align-items:center; justify-content:center; border-radius:8px;">
        <img id="modalImg" class="comprobante-img" src="" alt="Sin imagen">
        <div id="modalNoImg" style="display:none; color:#999;">Sin comprobante visual</div>
      </div>

      <div style="text-align:left; margin-top:15px; font-size:13px; color:#555;">
        <p><b>Nota:</b> <span id="modalObs">—</span></p>
        <p><b>Deuda Asociada (ID):</b> <span id="modalCobroID" class="mono">—</span></p>
      </div>

      <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
        <button class="btn-primary" style="background:#ef4444;" onclick="procesarPago('Rechazado')">
          <i class="fa-solid fa-xmark"></i> Rechazar
        </button>
        <button class="btn-primary" style="background:#10b981;" onclick="procesarPago('Aprobado')">
          <i class="fa-solid fa-check"></i> Aprobar Pago
        </button>
      </div>
      <button onclick="cerrarModal()" style="margin-top:15px; background:none; border:none; color:#666; cursor:pointer; text-decoration:underline;">Cancelar</button>
    </div>
  </div>

  <div id="pageSpinner" class="spinner-backdrop">
    <div style="background:white; padding:20px; border-radius:10px; text-align:center;">
      <div class="spinner" style="margin:0 auto 10px;"></div>
      <div>Procesando...</div>
    </div>
  </div>

  <div id="footer"></div>

  <script src="assets/js/pages/conciliacion.inline.js"></script>
</body>
</html>