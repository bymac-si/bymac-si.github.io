<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRM - Gestión de Propiedades</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a2b48">
<link rel="apple-touch-icon" href="assets/img/icon-192.png">

    <script src="assets/js/app.js"></script>
    <script>
      requireAuth();
    </script>

    
      <link rel="stylesheet" href="assets/css/pages/propiedades.inline.css">
</head>
  <body>
    <div id="header"></div>

    <main>
      <div class="dashboard-header no-print">
        <div>
          <h1 class="page-title" style="margin: 0">Propiedades</h1>
          <p style="margin: 5px 0 0; color: #64748b; font-size: 13px">
            Cartera de inmuebles y gestión.
          </p>
        </div>

        <div class="header-actions">
          <button class="btn-head btn-secundario" id="btnReload">
            <i class="fa-solid fa-rotate"></i> Actualizar
          </button>
          <button class="btn-head btn-secundario" id="btnExport">
            <i class="fa-solid fa-file-csv"></i> Exportar
          </button>
          <button class="btn-head btn-nuevo" id="btnNew">
            <i class="fa-solid fa-plus"></i> Nueva Propiedad
          </button>
        </div>
      </div>

      <div style="margin-bottom: 20px">
        <input
          id="inpBuscar"
          style="max-width: 300px"
          placeholder="Buscar propiedad..."
          type="text"
        />
      </div>

      <table>
        <thead>
          <tr>
            <th>Img</th>
            <th>Propiedad</th>
            <th>Tipo</th>
            <th>Precio</th>
            <th>Estado</th>
            <th>Propietario / Agente</th>
            <th class="no-print" style="width: 120px; text-align: right">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody id="tablaPropiedades">
          <tr>
            <td
              colspan="7"
              style="text-align: center; padding: 30px; color: #94a3b8"
            >
              Cargando...
            </td>
          </tr>
        </tbody>
      </table>
    </main>

    <div id="modalPropiedad" class="modal">
      <div class="modal-content">
        <h2 id="modalTitlePropiedad" style="margin-top: 0; margin-bottom: 20px">
          Datos de Propiedad
        </h2>
        <form id="formPropiedad">
          <input type="hidden" id="propiedadID" />

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div style="grid-column: 1 / -1">
              <label class="label">Título Publicación</label>
              <input id="propiedadTitulo" required />
            </div>
            <div style="grid-column: 1 / -1">
              <label class="label">Dirección</label>
              <input id="propiedadDireccion" required />
            </div>

            <div>
              <label class="label">Tipo</label>
              <select id="propiedadTipo">
                <option value="">Seleccione...</option>
                <option value="Casa">Casa</option>
                <option value="Departamento">Departamento</option>
                <option value="Terreno">Terreno</option>
                <option value="Oficina">Oficina</option>
                <option value="Bodega">Bodega</option>
              </select>
            </div>

            <div>
              <label class="label">Precio (CLP/UF)</label>
              <input type="number" id="propiedadPrecio" />
            </div>

            <div>
              <label class="label">Estado</label>
              <select id="propiedadEstado">
                <option value="Disponible">Disponible</option>
                <option value="Reservado">Reservado</option>
                <option value="Vendido">Vendido</option>
                <option value="Arrendado">Arrendado</option>
                <option value="Suspendido">Suspendido</option>
              </select>
            </div>

            <div style="grid-column: 1 / -1">
              <label class="label">Propietario (Cliente)</label>
              <div style="display: flex; gap: 8px">
                <select id="propiedadPropietario" style="flex-grow: 1">
                  <option value="">Cargando clientes...</option>
                </select>
                <button
                  type="button"
                  class="btn-add-inline"
                  title="Nuevo Cliente"
                  onclick="abrirModalCliente()"
                >
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
            </div>

            <div>
              <label class="label">Agente Captador</label>
              <select id="propiedadAgente">
                <option value="">Seleccione...</option>
              </select>
            </div>

            <div style="grid-column: 1 / -1; display: flex; gap: 10px">
              <div style="flex: 1">
                <label class="label">Dormitorios</label
                ><input type="number" id="propiedadDorms" />
              </div>
              <div style="flex: 1">
                <label class="label">Baños</label
                ><input type="number" id="propiedadBanos" />
              </div>
              <div style="flex: 1">
                <label class="label">M² Const.</label
                ><input type="number" id="propiedadM2C" />
              </div>
            </div>

            <div style="grid-column: 1 / -1">
              <label class="label">URL Imagen</label>
              <input id="propiedadImagen" placeholder="https://..." />
            </div>
          </div>

          <div
            style="
              text-align: right;
              margin-top: 25px;
              display: flex;
              justify-content: end;
              gap: 10px;
            "
          >
            <button
              type="button"
              class="btn-secundario"
              onclick="cerrarModalPropiedad()"
            >
              Cancelar
            </button>
            <button class="btn-primary">Guardar Propiedad</button>
          </div>
        </form>
      </div>
    </div>

    <div id="modalCliente" class="modal">
      <div class="modal-content" style="max-width: 450px">
        <h2 style="margin-top: 0">Nuevo Cliente</h2>
        <form id="formCliente" style="margin-top: 20px">
          <div style="display: flex; flex-direction: column; gap: 15px">
            <div>
              <label class="label">Nombre Completo</label>
              <input type="text" id="cliNombre" required />
            </div>
            <div>
              <label class="label">Email</label>
              <input type="email" id="cliEmail" required />
            </div>
            <div>
              <label class="label">Teléfono</label>
              <input type="text" id="cliTelefono" />
            </div>
            <div style="display: flex; gap: 10px">
              <div style="flex: 1">
                <label class="label">Interés</label>
                <select id="cliInteres">
                  <option value="Vender">Vender</option>
                  <option value="Arrendar">Arrendar</option>
                  <option value="Comprar">Comprar</option>
                </select>
              </div>
              <div style="flex: 1">
                <label class="label">Estado</label>
                <select id="cliEstado">
                  <option value="Activo">Activo</option>
                  <option value="Prospecto">Prospecto</option>
                </select>
              </div>
            </div>
          </div>
          <div
            style="
              text-align: right;
              margin-top: 25px;
              display: flex;
              justify-content: end;
              gap: 10px;
            "
          >
            <button
              type="button"
              class="btn-secundario"
              onclick="cerrarModalCliente()"
            >
              Cancelar
            </button>
            <button class="btn-primary">Crear</button>
          </div>
        </form>
      </div>
    </div>

    <div id="modalDetalle" class="modal">
      <div class="modal-content">
        <h2 style="margin-top: 0">Ficha Propiedad</h2>
        <div id="detalleContenido" style="margin: 20px 0"></div>
        <div style="text-align: right">
          <button
            class="btn-secundario"
            type="button"
            onclick="cerrarModalDetalle()"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>

    <div id="pageSpinner" class="spinner-backdrop">
      <div class="spinner-card">
        <div class="spinner"></div>
        <div
          id="spinnerText"
          style="margin-top: 10px; font-weight: 600; font-size: 13px"
        >
          Procesando...
        </div>
      </div>
    </div>

    <div id="footer"></div>

    <script src="assets/js/pages/propiedades.inline.js"></script>
  </body>
</html>
