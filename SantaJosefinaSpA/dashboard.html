<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRM Inmobiliario - Dashboard - Corretaje</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a2b48" />
    <link rel="apple-touch-icon" href="assets/img/icon-192.png" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-doughnutlabel-rebourne"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-funnel"></script>
    <script src="assets/js/app.js"></script>

    <script>
      requireAuth();
    </script>

    

    
      <link rel="stylesheet" href="assets/css/pages/dashboard.inline.css">
</head>
  <body>
    <div id="header"></div>

    <main>
      <div class="dashboard-header no-print">
        <div class="header-top">
          <h1 class="page-title">Panel de Control Corretaje</h1>
          <div class="header-actions">
            <button
              class="btn-head btn-secundario"
              id="btnReload"
              title="Recargar"
            >
              <i class="fa-solid fa-rotate-right"></i>
              <span class="btn-text">Recargar</span>
            </button>
            <button
              class="btn-head btn-secundario"
              onclick="window.print()"
              title="Imprimir"
            >
              <i class="fa-solid fa-print"></i>
              <span class="btn-text">Imprimir</span>
            </button>
          </div>
        </div>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card" style="border-left-color: #ffc107">
          <span class="kpi-title">Total Clientes</span>
          <span class="kpi-value" id="kpiClientes">0</span>
          <span class="kpi-sub">Activos en cartera</span>
        </div>
        <div class="kpi-card" style="border-left-color: #fd7e14">
          <span class="kpi-title">Propiedades Disp.</span>
          <span class="kpi-value" id="kpiPropiedades">0</span>
          <span class="kpi-sub">En venta/arriendo</span>
        </div>
        <div class="kpi-card" style="border-left-color: #198754">
          <span class="kpi-title">Visitas Agendadas</span>
          <span class="kpi-value" id="kpiVisitas">0</span>
          <span class="kpi-sub">Próximas fechas</span>
        </div>
        <div class="kpi-card" style="border-left-color: #0dcaf0">
          <span class="kpi-title">Tareas Pendientes</span>
          <span class="kpi-value" id="kpiTareasPendientes">0</span>
          <span class="kpi-sub">Acciones requeridas</span>
        </div>
      </div>
        <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Próximas Visitas</h2>
            <div style="overflow-y: auto; max-height: 300px">
              <table style="width: 100%; margin-top: 10px">
                <thead>
                  <tr>
                    <th style="padding: 10px">Cliente</th>
                    <th style="padding: 10px">Propiedad</th>
                    <th style="padding: 10px">Fecha</th>
                  </tr>
                </thead>
                <tbody id="tablaVisitasFuturas"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Cartera de Clientes por Estado</h2>
            <div
              style="max-height: 300px; display: flex; justify-content: center"
            >
              <canvas id="graficoClientesEstado"></canvas>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Embudo de Ventas (Propiedades)</h2>
            <canvas id="graficoEmbudo"></canvas>
          </div>
        </div>
      </div>

      <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Conversión: Leads vs Clientes</h2>
            <p
              style="
                font-size: 12px;
                color: #666;
                margin-top: -10px;
                margin-bottom: 15px;
              "
            >
              Comparativa de captación por campaña
            </p>
            <canvas id="graficoMarketing"></canvas>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Alcance de Campañas (Clicks)</h2>
            <p
              style="
                font-size: 12px;
                color: #666;
                margin-top: -10px;
                margin-bottom: 15px;
              "
            >
              Tráfico generado por fuente
            </p>
            <canvas id="graficoAlcance"></canvas>
          </div>
        </div>
      </div>


      <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Tareas por Estado</h2>
            <div
              style="max-height: 300px; display: flex; justify-content: center"
            >
              <canvas id="graficoTareasEstado"></canvas>
            </div>
          </div>
        </div>
      

        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Pendientes por Agente</h2>
            <div
              style="max-height: 300px; display: flex; justify-content: center"
            >
              <canvas id="graficoTareasAgente"></canvas>
            </div>
          </div>
        </div></div>
           <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card p-4 h-100">
            <h2>Detalle Tareas Pendientes</h2>
            <div style="overflow-x: auto; max-height: 300px">
              <table style="width: 100%; margin-top: 12px">
                <thead>
                  <tr>
                    <th style="text-align: left; padding: 12px">Título</th>
                    <th style="text-align: left; padding: 12px">Agente</th>
                    <th style="text-align: left; padding: 12px">Límite</th>
                  </tr>
                </thead>
                <tbody id="tablaTareasPendientes"></tbody>
              </table>
            </div>
          </div>
        </div></div>
      </div>

      <div class="col-md-12">
        <div class="card p-4">
          <h2>Cumplimiento Global vs Agentes</h2>
          <div style="text-align: center; margin-bottom: 30px">
            <div class="gauge-container">
              <canvas id="gaugeGlobal"></canvas>
              <p><b>Global Empresa</b></p>
              <p id="detalleGlobal" class="gauge-detail"></p>
            </div>
          </div>
          <div
            id="gaugesUsuarios"
            style="
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
              gap: 20px;
              padding-bottom: 20px;
            "
          ></div>
        </div>
      </div>
    </main>

    <div id="pageSpinner" class="spinner-backdrop hidden" aria-hidden="true">
      <div class="spinner-card">
        <div class="spinner"></div>
        <div id="spinnerText">Cargando Dashboard...</div>
      </div>
    </div>

    <div id="footer"></div>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/pages/dashboard.inline.js"></script>
</body>
</html>
