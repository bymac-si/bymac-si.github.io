<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Santa Josefina SpA - Gesti贸n Inmobiliaria Integral</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="assets/css/styles.css" />
    <script src="assets/js/app.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
      (function () {
        // Inicializaci贸n de EmailJS
        emailjs.init("7Il4AhmGHchP7qfxu");
      })();
    </script>

    <style>
      :root {
        --brand: #1a2b48;
        --accent: #e74e35;
        --muted: #5b5b5b;
        --line: #e5e7eb;
        --max: 1200px;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }
      html,
      body {
        margin: 0;
        padding: 0;
      }
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        color: var(--brand);
        background: #f7f7f7;
        max-width: 1200px;
        margin: 0 auto;
      }
      a {
        text-decoration: none;
      }
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }
      .container-narrow {
        max-width: var(--max);
        padding: 0 20px;
        margin: 0 auto;
      }

      li {
        list-style-type: square;
        font-weight: 900;
        text-align: left;
      }

      /* HEADER */
      .main-header {
        position: fixed;
        inset-inline: 0;
        top: 0;
        z-index: 30;
        background: rgba(255, 255, 255, 0.95);
        transition: background 0.25s, box-shadow 0.25s;
        height: 100px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }
      .main-header.scrolled {
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      }
      .navbar.container-fluid {
        max-width: var(--max);
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        height: 100%;
      }
      .nav-links a {
        margin-left: 16px;
        color: var(--brand);
        font-weight: 600;
      }
      .btn-primary {
        background: var(--accent);
        border-color: var(--accent);
        padding: 0.6rem 1rem;
        border-radius: 999px;
        font-weight: 700;
        color: #fff !important;
        transition: all 0.2s;
      }

      .nav-links a:hover {
        color: var(--accent);
        text-decoration: none;
      }

      .btn-primary:hover {
        filter: brightness(1.1);
        text-decoration: none;
        transform: translateY(-1px);
      }

      /* HERO */
      .hero {
        position: relative;
        min-height: 70vh;
        display: grid;
        place-items: center;
        padding: 120px 0 60px;
        isolation: isolate;
      }

      .hero::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url("assets/img/administracion-hero.png") center/cover
          no-repeat;
        opacity: 0.15;
        z-index: -1;
      }
      .hero-wrap {
        color: var(--brand);
        text-align: center;
      }
      .hero-kicker {
        color: #455c78;
        font-weight: 700;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        margin-bottom: 10px;
      }
      .hero-title {
        color: #cd241c;
        font-weight: 900;
        line-height: 1.1;
        font-size: clamp(32px, 5vw, 56px);
        max-width: 900px;
        margin: 0 auto 20px;
      }
      .hero-cta {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      /* FEATURES */
      .features {
        padding: 48px 0 20px;
      }
      .features-grid {
        display: grid;
        gap: 60px;
        grid-template-columns: repeat(12, 1fr);
        align-items: center;
      }
      .circles {
        grid-column: 1 / span 6;
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .circle {
        width: 180px;
        aspect-ratio: 1/1;
        border-radius: 50%;
        overflow: hidden;
        border: 8px solid #fff;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        margin: 0;
      }
      .circle img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .features-copy {
        grid-column: 7 / -1;
      }
      .kicker {
        font-size: 14px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--muted);
        margin: 0 0 8px;
        display: block;
      }
      .h2 {
        font-size: clamp(26px, 3.2vw, 40px);
        margin: 0 0 12px;
        line-height: 1.15;
      }
      .list {
        display: grid;
        gap: 20px;
        margin: 30px 0 0;
      }
      .item b {
        display: block;
        margin-bottom: 6px;
        color: var(--brand);
      }

      /* SECTIONS */
      #copropiedad {
        padding: 80px 0;
        text-align: center;
      }
      #propiedades {
        padding: 80px 0;
      }
      #listaPropiedades {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
      }
      #listaPropiedades > div {
        background: white;
        border: 1px solid var(--line);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s;
      }
      #listaPropiedades > div:hover {
        transform: translateY(-5px);
      }
      #listaPropiedades .card-body {
        padding: 20px;
      }

      #servicios {
        padding: 80px 0;
        background: #fafafa;
      }
      .services {
        display: grid;
        gap: 40px;
        grid-template-columns: 1fr 1fr;
        align-items: start;
      }
      .contact {
        display: grid;
        gap: 15px;
        background: white;
        padding: 30px;
        border-radius: 16px;
        box-shadow: var(--shadow);
      }
      .contact a {
        font-weight: 700;
        color: var(--brand);
      }
      .contact .hint {
        color: var(--muted);
        font-size: 14px;
      }

      /* FORM & MODAL */
      #formSection {
        padding: 80px 0;
        background: white;
      }
      #formContacto {
        display: grid;
        gap: 15px;
        max-width: 600px;
        margin: 0 auto;
      }
      #formContacto input,
      #formContacto textarea {
        border: 1px solid var(--line);
        border-radius: 8px;
        padding: 12px;
        width: 100%;
        background: #f9fafb;
      }
      #formContacto input:focus,
      #formContacto textarea:focus {
        outline: 2px solid var(--brand);
        background: white;
      }

      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(4px);
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        width: min(700px, 92vw);
        border-radius: 16px;
        padding: 25px;
        box-shadow: var(--shadow);
        max-height: 90vh;
        overflow-y: auto;
      }

      footer {
        background: var(--brand);
        padding: 40px 0;
        color: #fff;
        text-align: center;
        font-size: 14px;
      }

      @media (max-width: 980px) {
        .nav-links {
          display: none !important;
        }
        .hero-title {
          font-size: 36px;
        }
        .features-grid {
          grid-template-columns: 1fr;
          text-align: center;
        }
        .circles {
          grid-column: 1 / -1;
          margin-bottom: 30px;
        }
        .features-copy {
          grid-column: 1 / -1;
        }
        .services {
          grid-template-columns: 1fr;
        }
        .btn-group-custom {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <header class="main-header" id="mainHeader">
      <div class="navbar container-fluid">
        <a class="navbar-brand" href="index.html" aria-label="Inicio">
          <img
            src="assets/img/logo_santajosefina.png"
            alt="Santa Josefina"
            style="width: 140px; height: auto; position: relative; top: -35px"
          />
        </a>

        <button
          class="btn d-md-none"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#mobileMenu"
          style="border: 1px solid #ddd; padding: 8px 12px; background: #fff"
        >
          <i
            class="fa-solid fa-bars"
            style="color: var(--brand); font-size: 20px"
          ></i>
        </button>

        <nav
          class="nav-links d-none d-md-block"
          style="position: relative; top: -30px"
        >
          <a href="#servicios"><i class="fa-solid fa-headset"></i> Servicios</a>
          <a href="#copropiedad"
            ><i class="fa-solid fa-building"></i> Copropiedades</a
          >
          <a href="#propiedades"
            ><i class="fa-solid fa-house-flag"></i> Propiedades</a
          >
          <a href="#contacto"
            ><i class="fa-solid fa-envelopes-bulk"></i> Contacto</a
          >
        </nav>

        <div
          class="btn-group-custom d-none d-md-flex gap-2"
          style="position: relative; top: -30px"
        >
          <a href="login_residente.html" class="btn btn-primary btn-sm px-3">
            <i class="fa-solid fa-house-user"></i> Residentes
          </a>
          <a href="dashboard.html" class="btn btn-primary btn-sm px-3">
            <i class="fa-solid fa-briefcase"></i> Acceso Empresa
          </a>
        </div>
      </div>
    </header>

    <div
      class="offcanvas offcanvas-end"
      tabindex="-1"
      id="mobileMenu"
      aria-labelledby="mobileMenuLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileMenuLabel">
          <img
            src="assets/img/logo_santajosefina.png"
            alt="Santa Josefina"
            style="height: 28px; width: auto"
          />
        </h5>
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Cerrar"
        ></button>
      </div>
      <div class="offcanvas-body">
        <nav class="list-group list-group-flush mb-4">
          <a class="list-group-item list-group-item-action" href="#servicios"
            >Servicios</a
          >
          <a class="list-group-item list-group-item-action" href="#copropiedad"
            >Copropiedades</a
          >
          <a class="list-group-item list-group-item-action" href="#propiedades"
            >Propiedades</a
          >
          <a class="list-group-item list-group-item-action" href="#contacto"
            >Contacto</a
          >
        </nav>
        <div class="d-grid gap-2">
          <a
            class="btn btn-outline-dark rounded-pill"
            href="login_residente.html"
          >
            <i class="fa-solid fa-house-user"></i> Portal Residentes
          </a>
          <a class="btn btn-primary rounded-pill" href="dashboard.html">
            Acceso Corporativo
          </a>
        </div>
      </div>
    </div>

    <section class="hero">
      <div class="container-narrow hero-wrap">
        <div class="hero-kicker">Gesti贸n Inmobiliaria Integral</div>
        <h1 class="hero-title">ADMINISTRAR SU EDIFICIO PUEDE SER MS SIMPLE</h1>
        <p
          style="
            max-width: 700px;
            margin: 0 auto 30px;
            font-size: 1.2rem;
            color: #455c78;
          "
        >
          Nosotros lo acompa帽amos para que su comunidad funcione mejor, con
          orden, transparencia y cercan铆a.
        </p>
        <div class="hero-cta">
          <a href="#contacto" class="btn btn-primary btn-lg"
            >Habla con un especialista</a
          >
          <a href="#propiedades" class="btn btn-primary btn-lg"
            >Ver Propiedades</a
          >
        </div>
      </div>
    </section>

    <section class="features container-narrow">
      <div class="features-grid">
        <div class="circles" aria-hidden="true">
          <figure
            class="circle"
            style="position: relative; top: -130px; left: 130px"
          >
            <img src="assets/img/circ-1.jpg" alt="Transparencia" />
          </figure>
          <figure
            class="circle"
            style="position: relative; top: -210px; left: 240px"
          >
            <img src="assets/img/circ-2.jpg" alt="Gesti贸n" />
          </figure>
          <figure
            class="circle"
            style="position: relative; top: -510px; left: 630px"
          >
            <img src="assets/img/circ-3.jpg" alt="Comunidad" />
          </figure>
        </div>
        <div class="features-copy">
          <span class="kicker">lo que nos define</span>
          <h2 class="h2" style="margin-bottom: 30px; color: var(--brand)">
            Gastos comunes claros.<br />Administraci贸n Ley 21.442.<br />Trato
            directo.
          </h2>
          <div class="list">
            <div class="item">
              <b style="text-transform: uppercase">Transparencia real</b>
              <p>
                Gastos comunes claros, bien explicados y siempre disponibles
                para el comit茅.
              </p>
            </div>
            <div class="item">
              <b style="text-transform: uppercase"
                >Planificaci贸n que da tranquilidad</b
              >
              <p>
                Presupuestos semestrales y anuales que permiten anticipar gastos
                y evitar imprevistos.
              </p>
            </div>
            <div class="item">
              <b style="text-transform: uppercase">Acompa帽amiento permanente</b>
              <p>
                Presencia, respuesta oportuna y trabajo conjunto con su
                comunidad.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section
      id="copropiedad"
      class="container-narrow"
      style="
        background: white;
        border-radius: 16px;
        margin: 40px auto;
        padding: 60px 40px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
      "
    >
      <h2 style="color: var(--accent)">
        Una administraci贸n cercana, que se hace cargo
      </h2>
      <p
        style="
          max-width: 800px;
          margin: 0 auto 20px;
          font-size: 18px;
          color: var(--muted);
        "
      >
        En Santa Josefina SpA entendemos que administrar un edificio no es solo
        manejar n煤meros, es acompa帽ar a personas, comit茅s y comunidades.
        Trabajamos con orden, transparencia y responsabilidad.
      </p>
      <h3 style="font-size: 20px; font-weight: 700; color: var(--brand)">
        Cuando la administraci贸n funciona, la comunidad se siente tranquila.
      </h3>
    </section>

    <section id="propiedades" style="background: #eef2f6">
      <div class="container-narrow">
        <div style="text-align: center; margin-bottom: 40px">
          <span class="kicker">Corretaje</span>
          <h2 style="color: var(--brand)">Propiedades Disponibles</h2>
        </div>
        <div id="listaPropiedades">
          <p style="text-align: center; width: 100%">Cargando propiedades...</p>
        </div>
      </div>
    </section>

    <section id="servicios">
      <div class="container-narrow services">
        <div>
          <h2>Servicios Especializados</h2>
          <p style="color: var(--muted); margin-bottom: 20px">
            Santa Josefina SpA se especializa en la Administraci贸n de Edificios
            y Condominios Horizontales, adem谩s de servicios de corretaje
            integrales.
          </p>
          <ul style="color: var(--brand)">
            <li>Compra y venta de propiedades residenciales y comerciales.</li>
            <li>Arriendos y gesti贸n integral para inversionistas.</li>
            <li>Asesor铆a legal y financiera en transacciones.</li>
            <li>Promoci贸n y marketing digital de propiedades.</li>
          </ul>
        </div>
        <aside id="contacto" class="contact">
          <h3 style="margin-top: 0">Solicite una evaluaci贸n</h3>
          <p class="hint">Sin compromiso. Respuesta en horario h谩bil.</p>

          <div style="display: flex; flex-direction: column; gap: 10px">
            <a
              href="tel:+56998647190"
              style="display: flex; align-items: center; gap: 10px"
            >
              <i class="fa-solid fa-phone" style="color: var(--accent)"></i> +56
              9 9864 7190
            </a>
            <a
              href="mailto:marcos.castro@santajosefinaspa.cl"
              style="display: flex; align-items: center; gap: 10px"
            >
              <i class="fa-solid fa-envelope" style="color: var(--accent)"></i>
              marcos.castro@santajosefinaspa.cl
            </a>
          </div>

          <a
            class="btn btn-primary w-100 mt-3"
            href="mailto:marcos.castro@santajosefinaspa.cl?subject=Consulta%20Web"
          >
            Enviar correo directo
          </a>
        </aside>
      </div>
    </section>

    <section id="formSection">
      <div class="container-narrow">
        <div style="text-align: center; margin-bottom: 30px">
          <h2>Cont谩ctenos</h2>
          <p class="text-muted">
            D茅jenos sus datos y lo contactaremos a la brevedad.
          </p>
        </div>
        <form id="formContacto">
          <input
            id="contactoNombre"
            type="text"
            placeholder="Nombre completo"
            required
          />
          <input
            id="contactoEmail"
            type="email"
            placeholder="Correo electr贸nico"
            required
          />
          <input
            id="contactoTelefono"
            type="tel"
            placeholder="Tel茅fono (+569...)"
          />
          <textarea
            id="contactoMensaje"
            placeholder="驴En qu茅 podemos ayudarle?"
            rows="4"
            required
          ></textarea>

          <button
            type="submit"
            class="btn btn-primary w-100"
            id="btnSubmitContacto"
          >
            Enviar Mensaje
          </button>
        </form>
        <div
          id="msgConfirmacion"
          style="
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #dcfce7;
            color: #166534;
            border-radius: 8px;
          "
        >
          <i class="fa-solid fa-check-circle"></i> 隆Gracias! Su mensaje ha sido
          recibido correctamente.
        </div>
      </div>
    </section>

    <div id="modalPropiedad" class="modal" aria-hidden="true">
      <div class="modal-content">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
          "
        >
          <h2
            id="detalleTitulo"
            style="
              font-size: 20px;
              font-weight: bold;
              margin: 0;
              color: var(--brand);
            "
          ></h2>
          <button class="btn-close" onclick="cerrarModal()"></button>
        </div>

        <img
          id="detalleImagen"
          src=""
          alt="Propiedad"
          style="
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
          "
        />

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
          "
        >
          <div><b>Tipo:</b> <span id="detalleTipo"></span></div>
          <div>
            <b>Precio:</b>
            <span
              id="detallePrecio"
              style="color: var(--accent); font-weight: bold"
            ></span>
          </div>
          <div><b>Comuna:</b> <span id="detalleComuna"></span></div>
          <div><b>Regi贸n:</b> <span id="detalleRegion"></span></div>
        </div>

        <h4
          style="
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
          "
        >
          Caracter铆sticas
        </h4>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
          "
        >
          <div>
            <i class="fa-solid fa-ruler-combined text-muted"></i> Const:
            <span id="detalleMetrosConstruidos"></span>
          </div>
          <div>
            <i class="fa-solid fa-maximize text-muted"></i> Total:
            <span id="detalleMetrosTotales"></span>
          </div>
          <div>
            <i class="fa-solid fa-bed text-muted"></i> Dorms:
            <span id="detalleDormitorios"></span>
          </div>
          <div>
            <i class="fa-solid fa-bath text-muted"></i> Ba帽os:
            <span id="detalleBanos"></span>
          </div>
        </div>

        <div style="margin-top: 25px; text-align: center">
          <a
            href="#contacto"
            onclick="cerrarModal()"
            class="btn btn-primary w-100"
            >Me interesa esta propiedad</a
          >
        </div>
      </div>
    </div>

    <footer>
      <div class="container-narrow">
        <p style="margin: 0; opacity: 0.8">
          漏 <span id="y">2026</span> Santa Josefina SpA 路 Gesti贸n Inmobiliaria
          Integral
        </p>
      </div>
    </footer>

    <script>
      // CONFIGURACIN NOTIFICACIONES
      const ADMIN_EMAIL = "marcos.castro@santajosefinaspa.cl";

      // 1. Efecto Scroll Header
      const h = document.getElementById("mainHeader");
      const onScroll = () =>
        h.classList.toggle("scrolled", window.scrollY > 10);
      document.addEventListener("scroll", onScroll, { passive: true });
      onScroll();

      // 2. A帽o actual
      document.getElementById("y").textContent = new Date().getFullYear();

      // 3. Cargar Propiedades
      let propiedadesGlobal = [];

      async function cargarPropiedadesLanding() {
        try {
          propiedadesGlobal =
            typeof fetchData === "function"
              ? await fetchData("Propiedades")
              : [];
        } catch (e) {
          console.error(e);
        }

        const disponibles = propiedadesGlobal
          .filter((p) => (p.Estado || "") === "Disponible")
          .slice(0, 6);

        const contenedor = document.getElementById("listaPropiedades");

        if (disponibles.length === 0) {
          contenedor.innerHTML =
            '<p style="text-align: center; width: 100%; color: #888;">No hay propiedades destacadas en este momento.</p>';
          return;
        }

        contenedor.innerHTML = disponibles
          .map(
            (p, i) => `
          <div>
            <div style="position:relative;">
                <img src="${
                  p.ImagenURL || "assets/img/default_prop.jpg"
                }" alt="Propiedad" style="width:100%; height:200px; object-fit:cover;">
                <span style="position:absolute; top:10px; right:10px; background:var(--accent); color:white; padding:4px 10px; border-radius:20px; font-size:12px; font-weight:bold;">${
                  p.Operacion || "Venta"
                }</span>
            </div>
            <div class="card-body">
              <h3 style="font-size:18px; margin-bottom:5px; font-weight:700;">${
                p.Titulo || "Propiedad"
              }</h3>
              <p style="color:var(--muted); font-size:14px; margin-bottom:10px;">${
                p.Tipo || ""
              } en ${p.Comuna || ""}</p>
              <p style="font-weight:800; font-size:20px; color:var(--brand);">
                ${"$" + new Intl.NumberFormat("es-CL").format(p.Precio || 0)}
              </p>
              <div style="display:flex; gap:10px; margin-top:15px;">
                <button onclick="abrirModal(${i})" class="btn btn-primary btn-sm w-100">Ver detalles</button>
              </div>
            </div>
          </div>
        `
          )
          .join("");
      }

      // 4. Modal
      function abrirModal(index) {
        const p = propiedadesGlobal[index] || {};
        document.getElementById("detalleTitulo").textContent =
          p.Titulo || "Detalle Propiedad";
        document.getElementById("detalleImagen").src = p.ImagenURL || "";
        document.getElementById("detalleTipo").textContent = p.Tipo || "-";
        document.getElementById("detalleComuna").textContent = p.Comuna || "-";
        document.getElementById("detalleRegion").textContent = p.Region || "-";
        document.getElementById("detallePrecio").textContent =
          "$" + new Intl.NumberFormat("es-CL").format(p.Precio || 0);

        document.getElementById("detalleMetrosConstruidos").textContent =
          (p.MetrosConstruidos || "-") + " m虏";
        document.getElementById("detalleMetrosTotales").textContent =
          (p.MetrosTotales || "-") + " m虏";
        document.getElementById("detalleDormitorios").textContent =
          p.Dormitorios || "-";
        document.getElementById("detalleBanos").textContent = p.Banos || "-";

        document.getElementById("modalPropiedad").classList.add("active");
      }
      function cerrarModal() {
        document.getElementById("modalPropiedad").classList.remove("active");
      }

      cargarPropiedadesLanding();

      // 5. ENVO FORMULARIO -> CRM & EMAIL
      const formContacto = document.getElementById("formContacto");

      formContacto.onsubmit = async (e) => {
        e.preventDefault();

        const btn = document.getElementById("btnSubmitContacto");
        const originalText = btn.innerText;
        btn.innerText = "Enviando...";
        btn.disabled = true;

        const nuevoID = "WEB_" + Date.now();
        const fechaHoy = new Date().toISOString().split("T")[0];

        // Datos del prospecto
        const payload = {
          ID: nuevoID,
          Nombre: document.getElementById("contactoNombre").value.trim(),
          Email: document.getElementById("contactoEmail").value.trim(),
          Telefono: document.getElementById("contactoTelefono").value.trim(),
          Observaciones: document
            .getElementById("contactoMensaje")
            .value.trim(),
          "Fecha Registro": fechaHoy,
          Estado: "Nuevo",
          Canal: "Web Landing",
          "Tipo Operacion": "Consulta Web",
          Agente: "Asignar",
        };

        try {
          // A. Guardar en AppSheet (Tabla Corretaje)
          if (typeof appSheetCRUD === "function") {
            await appSheetCRUD("ProspectosCorretaje", "Add", [payload]);
          } else {
            console.warn("AppSheet CRUD no disponible.");
          }

          // B. Enviar notificaci贸n por correo
          await notificarNuevoLead(payload);

          // C. Feedback y Reset
          formContacto.reset();
          document.getElementById("msgConfirmacion").style.display = "block";
          setTimeout(() => {
            document.getElementById("msgConfirmacion").style.display = "none";
          }, 6000);
        } catch (err) {
          console.error(err);
          alert("Hubo un error al procesar la solicitud.");
        } finally {
          btn.innerText = originalText;
          btn.disabled = false;
        }
      };

      // Funci贸n espec铆fica para notificaci贸n de Leads Web
      async function notificarNuevoLead(data) {
        if (typeof emailjs === "undefined") return;

        const htmlBody = `
            <div style="font-family:sans-serif; padding:20px; border:2px solid #1A2B48; border-radius:10px;">
                <h2 style="color:#1A2B48;"> Nuevo Prospecto Web</h2>
                <p>Un visitante ha completado el formulario de contacto:</p>
                <ul style="background:#f9fafb; padding:15px; border-radius:5px;">
                    <li><strong>Nombre:</strong> ${data.Nombre}</li>
                    <li><strong>Email:</strong> ${data.Email}</li>
                    <li><strong>Tel茅fono:</strong> ${data.Telefono}</li>
                    <li><strong>Fecha:</strong> ${data["Fecha Registro"]}</li>
                </ul>
                <p><strong>Mensaje:</strong></p>
                <blockquote style="border-left:4px solid #e74e35; padding-left:10px; color:#555;">
                    ${data.Observaciones}
                </blockquote>
                <p style="font-size:12px; color:#888;">Lead guardado en CRM (ProspectosCorretaje).</p>
            </div>
        `;

        // Env铆o usando Template gen茅rico
        // Ajusta ServiceID y TemplateID seg煤n tu cuenta EmailJS
        return emailjs
          .send("service_p9hqkqn", "template_80q9psi", {
            to_email: ADMIN_EMAIL,
            subject: `[WEB] Nuevo Lead: ${data.Nombre}`,
            html_body: htmlBody,
            // Par谩metros de respaldo por si el template usa {{variables}}
            nombre: data.Nombre,
            email: data.Email,
            mensaje: data.Observaciones,
          })
          .catch((e) => console.warn("Error enviando email:", e));
      }

      // 6. Cerrar men煤 m贸vil
      document.addEventListener("DOMContentLoaded", function () {
        const off = document.getElementById("mobileMenu");
        if (!off) return;
        off.querySelectorAll("a").forEach((a) => {
          a.addEventListener("click", () => {
            const inst = bootstrap.Offcanvas.getInstance(off);
            if (inst) inst.hide();
          });
        });
      });
    </script>
  </body>
</html>
