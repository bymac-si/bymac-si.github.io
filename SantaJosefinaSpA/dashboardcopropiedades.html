<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRM - Dashboard Financiero</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/styles.css" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a2b48">
<link rel="apple-touch-icon" href="assets/img/icon-192.png">


    <script src="assets/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      requireAuth();
    </script>
    
      <link rel="stylesheet" href="assets/css/pages/dashboardcopropiedades.inline.css">
</head>
  <body>
    <div id="header"></div>
    <main>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        "
      >
        <div>
          <h1 class="page-title" style="margin: 0">Dashboard Condominios</h1>
          <p class="muted" style="margin: 5px 0 0; font-size: 0.9em">
            Control de Gestión y Tributario
          </p>
        </div>
        <div style="text-align: right">
          <span class="muted" style="font-size: 0.9em; margin-right: 10px"
            >UTM: <span class="mono" id="lblUTM">...</span></span
          >
          <button class="btn-primary" onclick="abrirModalGasto()">
            + Registrar Gasto
          </button>
          <button
            class="btn-primary"
            onclick="location.reload()"
            style="background: #64748b"
          >
            ↻
          </button>
        </div>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card" style="border-left-color: #1a2b48">
          <span class="kpi-title">Comunidades</span>
          <span class="kpi-value" id="kpiClientes">0</span>
          <span class="kpi-sub">Unidades: <span id="kpiUnidades">0</span></span>
        </div>
        <div class="kpi-card" style="border-left-color: #f59e0b">
          <span class="kpi-title">Prospectos</span>
          <span class="kpi-value" id="kpiProspectos">0</span>
          <span class="kpi-sub">Activos</span>
        </div>
        <div class="kpi-card" style="border-left-color: #10b981">
          <span class="kpi-title">Ingreso Neto (Est.)</span>
          <span class="kpi-value text-success mono" id="kpiIngresos">$0</span>
          <span class="kpi-sub">Facturación Mensual</span>
        </div>
        <div class="kpi-card" style="border-left-color: #ef4444">
          <span class="kpi-title">Gastos Operativos</span>
          <span class="kpi-value text-danger mono" id="kpiGastosOp">$0</span>
          <span class="kpi-sub">Mes Actual</span>
        </div>
        
        <div class="kpi-card" style="border-left-color: #6366f1">
          <span class="kpi-title">Gasto Sueldos</span>
          <span class="kpi-value text-danger mono" id="kpiSueldos">$0</span>
          <span class="kpi-sub">Personal</span>
        </div>

        <div class="kpi-card" style="border-left-color: #8b5cf6">
          <span class="kpi-title">Margen %</span>
          <span class="kpi-value text-purple" id="kpiMargenPct">0%</span>
          <span class="kpi-sub">Rentabilidad Mes</span>
        </div>

        <div class="kpi-card" style="border-left-color: #10b981">
          <span class="kpi-title">Margen Operacional ($)</span>
          <span class="kpi-value text-success mono" id="kpiMargenMonto">$0</span>
          <span class="kpi-sub">Utilidad Neta</span>
        </div>

        <div class="kpi-card" style="border-left-color: #3b82f6">
          <span class="kpi-title">IVA Débito (F29)</span>
          <span class="kpi-value text-info mono" id="kpiIVA">$0</span>
          <span class="kpi-sub">Proyección Fiscal</span>
        </div>
        <div class="kpi-card" style="border-left-color: #f97316">
          <span class="kpi-title">IVA Crédito (F29)</span>
          <span class="kpi-value text-warning mono" id="kpiIVACredito">$0</span>
          <span class="kpi-sub">Compras con Factura</span>
        </div>
      </div>

      <div class="finance-grid">
        <div class="card">
          <h3 style="margin-top: 0">Resultado Operacional (Mes)</h3>
          <table class="table-finance">
            <thead>
              <tr>
                <th>Ítem</th>
                <th style="text-align: right">Monto Neto</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>(+) Ingresos Honorarios</td>
                <td
                  style="text-align: right"
                  class="mono text-success"
                  id="finIngresos"
                >
                  $0
                </td>
              </tr>
              <tr>
                <td>(-) Gastos Operativos</td>
                <td
                  style="text-align: right"
                  class="mono text-danger"
                  id="finGastos"
                >
                  $0
                </td>
              </tr>
              <tr class="row-highlight" style="background: #f0f9ff">
                <td>(=) Margen ($)</td>
                <td
                  style="text-align: right"
                  class="mono text-info"
                  id="finMargen"
                >
                  $0
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="card">
          <h3 style="margin-top: 0">Detalle Tributario (Estimado)</h3>
          <table class="table-finance">
            <thead>
              <tr>
                <th>Impuesto</th>
                <th style="text-align: right">Monto IVA</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>(+) IVA Débito (Ventas)</td>
                <td
                  style="text-align: right"
                  class="mono text-danger"
                  id="taxDebito"
                >
                  $0
                </td>
              </tr>
              <tr>
                <td>(-) IVA Crédito (Compras)</td>
                <td
                  style="text-align: right"
                  class="mono text-success"
                  id="taxCredito"
                >
                  $0
                </td>
              </tr>
              <tr class="row-highlight">
                <td>(=) A Pagar F29</td>
                <td style="text-align: right" class="mono" id="taxPagar">$0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">Ingresos Netos por Cliente (Top 5)</div>
          <div class="chart-container">
            <canvas id="chartIngresosNetos"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">Distribución de Gastos (Mes Actual)</div>
          <div class="chart-container">
            <canvas id="chartGastosCat"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">Evolución Gastos Operativos (6 Meses)</div>
          <div class="chart-container">
            <canvas id="chartEvolucionOp"></canvas>
          </div>
        </div>
      </div>
    </main>

    <div id="modalGasto" class="modal">
      <div class="modal-card">
        <h3 style="margin-top: 0">Nuevo Gasto</h3>
        <form id="formGastoOp">
          <div class="form-group">
            <label>Categoría</label>
            <select id="gastoCat" required>
              <option value="General">General</option>
              <option value="Sueldos">Sueldos</option>
              <option value="Arriendo">Arriendo</option>
              <option value="Software">Software</option>
              <option value="Marketing">Marketing</option>
              <option value="Impuestos">Impuestos</option>
            </select>
          </div>
          <div class="form-group">
            <label>Descripción</label>
            <input id="gastoDesc" required />
          </div>
          <div class="form-group">
            <label>Monto Neto</label>
            <input
              id="gastoMonto"
              type="number"
              min="0"
              required
              oninput="calcIVAGasto()"
            />
          </div>
          <div
            class="form-group"
            style="display: flex; align-items: center; gap: 10px"
          >
            <label style="margin: 0">Con IVA</label>
            <input
              type="checkbox"
              id="gastoCheckIVA"
              onchange="calcIVAGasto()"
              style="width: auto"
            />
          </div>
          <div class="form-group">
            <label>Monto IVA</label>
            <input
              id="gastoIVA"
              type="number"
              readonly
              value="0"
              style="background: #eee"
            />
          </div>
          <div style="text-align: right; margin-top: 20px">
            <button
              type="button"
              class="btn-primary"
              style="background: #999"
              onclick="document.getElementById('modalGasto').classList.remove('active')"
            >
              Cerrar
            </button>
            <button type="submit" class="btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="pageSpinner" class="spinner-backdrop" style="display: none">
      <div class="spinner-card">
        <div class="spinner"></div>
        <div>Procesando...</div>
      </div>
    </div>
    <br /><br /><br />
    <div id="footer"></div>

    <script src="assets/js/pages/dashboardcopropiedades.inline.js"></script>
  </body>
</html>