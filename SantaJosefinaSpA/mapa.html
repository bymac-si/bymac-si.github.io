<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRM - Mapa de Prospectos</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <script src="assets/js/app.js"></script>
    <script>
      requireAuth();
    </script>

    
      <link rel="stylesheet" href="assets/css/pages/mapa.inline.css">
</head>
  <body>
    <div class="map-header">
      <h1 class="map-title"><i class="fa-solid fa-map"></i> Mapa Prospectos</h1>
      <div class="map-stats" id="mapStats">Cargando datos...</div>
    </div>

    <div class="filter-container">
      <button class="btn-filter active" onclick="filtrarMapa('Todos', this)">
        Todos
      </button>
      <button class="btn-filter" onclick="filtrarMapa('Nuevo', this)">
        <span class="dot" style="background: #0369a1"></span> Nuevos
      </button>
      <button class="btn-filter" onclick="filtrarMapa('En Negociaci贸n', this)">
        <span class="dot" style="background: #c2410c"></span> Negociaci贸n
      </button>
      <button class="btn-filter" onclick="filtrarMapa('Cerrado Ganado', this)">
        <span class="dot" style="background: #15803d"></span> Clientes
      </button>
    </div>

    <a href="prospectos.html" class="btn-back"
      ><i class="fa-solid fa-arrow-left"></i> Volver a Lista</a
    >

    <div id="map"></div>

    <div
      id="modalProspecto"
      class="modal"
      style="
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        class="modal-content"
        style="
          background: white;
          padding: 30px;
          border-radius: 12px;
          width: 400px;
          box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        "
      >
        <h2 style="margin-top: 0; color: #1e293b">Editar Estado</h2>
        <form id="formEdicion">
          <input type="hidden" id="pID" />
          <div style="margin-bottom: 15px">
            <label
              style="
                display: block;
                font-size: 12px;
                font-weight: bold;
                color: #64748b;
                margin-bottom: 5px;
              "
              >Nombre</label
            >
            <input
              id="pNombre"
              style="
                width: 100%;
                padding: 10px;
                border: 1px solid #cbd5e1;
                border-radius: 6px;
                box-sizing: border-box;
              "
              readonly
            />
          </div>
          <div style="margin-bottom: 15px">
            <label
              style="
                display: block;
                font-size: 12px;
                font-weight: bold;
                color: #64748b;
                margin-bottom: 5px;
              "
              >Nuevo Estado</label
            >
            <select
              id="pEstado"
              style="
                width: 100%;
                padding: 10px;
                border: 1px solid #cbd5e1;
                border-radius: 6px;
                box-sizing: border-box;
              "
            >
              <option value="Nuevo">Nuevo</option>
              <option value="Contactado">Contactado</option>
              <option value="Propuesta Enviada">Propuesta Enviada</option>
              <option value="En Negociaci贸n">En Negociaci贸n</option>
              <option value="Cerrado Ganado">Cerrado Ganado</option>
              <option value="Cerrado Perdido">Cerrado Perdido</option>
            </select>
          </div>
          <div
            style="
              text-align: right;
              gap: 10px;
              display: flex;
              justify-content: flex-end;
            "
          >
            <button
              type="button"
              onclick="document.getElementById('modalProspecto').style.display='none'"
              style="
                padding: 10px 15px;
                border: 1px solid #ccc;
                background: white;
                border-radius: 6px;
                cursor: pointer;
              "
            >
              Cancelar
            </button>
            <button
              type="submit"
              style="
                padding: 10px 15px;
                border: none;
                background: #1e293b;
                color: white;
                border-radius: 6px;
                cursor: pointer;
              "
            >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="spinner" class="spinner-overlay">
      <div style="text-align: center">
        <div class="spinner"></div>
        <p style="margin-top: 10px; font-weight: 600; color: #1e293b">
          Cargando mapa...
        </p>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="assets/js/pages/mapa.inline.js"></script>
  </body>
</html>
